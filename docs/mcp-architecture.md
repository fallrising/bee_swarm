# MCP Server 架構設計

## 概述

Bee Swarm 項目採用 MCP (Model Context Protocol) Server 架構，將 LLM 作為大腦進行計算和推理，而 MCP Server 作為五感及手腳提供外部依賴和工具。

## 架構理念

### 核心原則

1. **LLM 專注於推理**：LLM 只負責計算、推理和決策
2. **MCP 提供工具**：所有外部依賴、工具和服務通過 MCP Server 提供
3. **輕量化容器**：角色容器保持最小化，只包含必要的環境設置
4. **外部化依賴**：避免在容器內安裝大量軟體，減少容器大小和維護成本

### 架構優勢

- **更快的啟動時間**：輕量化容器啟動更快
- **更好的可維護性**：依賴集中在 MCP Server 中管理
- **更靈活的擴展**：可以動態添加新的 MCP Server 提供新功能
- **更好的資源利用**：避免重複安裝相同的工具

## 容器設計

### 基礎鏡像

使用 [VNC Lab](https://github.com/fallrising/vnc_lab) 的 `novnc_llm_cli` 作為基礎鏡像，該鏡像已包含：

- 基本的 AI LLM coding CLI 工具
- noVNC 桌面環境
- Web 終端支持
- 基本的開發環境

### 角色容器

每個角色容器只包含：

1. **工作目錄結構**：角色特定的目錄組織
2. **環境變量**：角色特定的配置
3. **用戶設置**：角色用戶和權限
4. **啟動腳本**：容器啟動邏輯

### 移除的內容

- Node.js 和 npm 包安裝
- Python 和 pip 包安裝
- Go 語言環境
- 各種開發工具和框架
- 數據庫客戶端
- 監控工具

## MCP Server 集成

### 可用的 MCP Server

1. **文件系統服務**：文件讀寫、目錄操作
2. **代碼執行服務**：運行代碼、執行命令
3. **網絡服務**：HTTP 請求、API 調用
4. **數據庫服務**：數據庫連接和操作
5. **工具服務**：各種開發工具和框架

### 連接方式

LLM 通過 MCP 協議與外部服務通信，獲取：

- 文件內容和結構
- 代碼執行結果
- 網絡請求響應
- 數據庫查詢結果
- 工具執行結果

## 使用指南

### 構建基礎鏡像

```bash
# 運行構建腳本
./scripts/build_base_image.sh
```

### 構建角色容器

```bash
# 構建特定角色容器
docker build -t bee-swarm-backend:latest roles/backend_developer/
```

### 運行容器

```bash
# 運行角色容器
docker run -d \
  --name bee-swarm-backend \
  -p 6080:6080 \
  -p 7681:7681 \
  bee-swarm-backend:latest
```

## 最佳實踐

1. **保持容器輕量化**：只添加角色特定的配置
2. **使用環境變量**：通過環境變量配置角色行為
3. **標準化目錄結構**：保持一致的目錄組織
4. **文檔化配置**：記錄角色特定的設置和依賴

## 未來擴展

1. **動態 MCP Server**：支持運行時添加新的 MCP Server
2. **服務發現**：自動發現和連接可用的 MCP Server
3. **負載均衡**：在多個 MCP Server 間分配負載
4. **監控和日誌**：MCP Server 的監控和日誌收集 