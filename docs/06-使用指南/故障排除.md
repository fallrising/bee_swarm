# 故障排除指南

## 常見問題與解決方案

### 🐛 模擬器問題

#### 問題: 模擬腳本運行失敗
```bash
# 錯誤信息
ModuleNotFoundError: No module named 'simpy'
```

**解決方案:**
```bash
# 安裝 Python 依賴
pip install simpy colorama matplotlib seaborn pandas numpy

# 或使用項目需求文件
pip install -r docs/05-simulation/scripts/requirements.txt
```

#### 問題: 模擬結果異常
```bash
# 錯誤信息
Simulation completed with warnings: Task completion rate below 50%
```

**解決方案:**
1. 檢查角色配置參數
2. 調整任務複雜度設置
3. 增加模擬時間長度
```python
# 在模擬腳本中調整參數
SIMULATION_TIME = 1000  # 增加模擬時間
TASK_COMPLEXITY_RANGE = (1, 5)  # 降低任務複雜度
```

### 🔧 環境配置問題

#### 問題: Docker 容器啟動失敗
```bash
# 錯誤信息
Error response from daemon: driver failed programming external connectivity
```

**解決方案:**
```bash
# 重啟 Docker 服務
sudo systemctl restart docker

# 檢查端口衝突
sudo netstat -tulpn | grep :8080

# 修改 docker-compose.yml 中的端口映射
ports:
  - "8081:8080"  # 改為其他端口
```

#### 問題: 環境變量配置錯誤
```bash
# 錯誤信息
KeyError: 'GITHUB_TOKEN'
```

**解決方案:**
```bash
# 複製環境變量模板
cp .env.example .env

# 編輯環境變量
vim .env

# 設置必要的環境變量
export GITHUB_TOKEN="your_github_token"
export GEMINI_API_KEY="your_gemini_key"
```

### 🤖 AI 角色問題

#### 問題: Gemini CLI 認證失敗
```bash
# 錯誤信息
Authentication failed: Invalid API key
```

**解決方案:**
```bash
# 重新配置 Gemini CLI
gemini config set api_key YOUR_API_KEY

# 驗證配置
gemini config list

# 測試連接
gemini generate "Hello, world!"
```

#### 問題: GitHub API 限制
```bash
# 錯誤信息
GitHub API rate limit exceeded
```

**解決方案:**
```bash
# 檢查 API 使用情況
curl -H "Authorization: token YOUR_TOKEN" \
     https://api.github.com/rate_limit

# 等待限制重置或使用不同的 token
# 配置多個 GitHub tokens 進行輪換
```

### 📋 項目管理問題

#### 問題: Issue 創建失敗
```bash
# 錯誤信息
Error: Repository not found or insufficient permissions
```

**解決方案:**
1. 確認 GitHub token 權限
2. 檢查倉庫訪問權限
```bash
# 測試倉庫訪問
git ls-remote https://github.com/your-org/your-repo.git

# 更新 remote URL
git remote set-url origin https://token@github.com/your-org/your-repo.git
```

#### 問題: PR 自動合併失敗
```bash
# 錯誤信息
Merge conflict detected in automated merge
```

**解決方案:**
```bash
# 手動解決衝突
git checkout main
git pull origin main
git checkout feature-branch
git rebase main

# 解決衝突後
git add .
git rebase --continue
git push --force-with-lease
```

### 🚀 部署問題

#### 問題: 容器間通信失敗
```bash
# 錯誤信息
Connection refused: backend service unreachable
```

**解決方案:**
```yaml
# 在 docker-compose.yml 中確保網絡配置
networks:
  bee-swarm-network:
    driver: bridge

services:
  backend:
    networks:
      - bee-swarm-network
  frontend:
    networks:
      - bee-swarm-network
```

#### 問題: 資源不足
```bash
# 錯誤信息
OOMKilled: Container killed due to memory limit
```

**解決方案:**
```yaml
# 調整容器資源限制
services:
  app:
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M
```

### 🔍 調試技巧

#### 啟用詳細日誌
```bash
# 設置日誌級別
export LOG_LEVEL=DEBUG

# Docker 容器日誌
docker logs -f container_name

# 系統日誌
journalctl -u bee-swarm -f
```

#### 性能監控
```bash
# 監控容器資源使用
docker stats

# 監控系統資源
htop

# 監控網絡連接
netstat -tulpn
```

#### 健康檢查
```bash
# 檢查服務狀態
curl -f http://localhost:8080/health || exit 1

# 檢查數據庫連接
docker exec app-container pg_isready
```

### 📞 獲取幫助

#### 社區支持
- GitHub Issues: [https://github.com/fallrising/bee_swarm/issues](https://github.com/fallrising/bee_swarm/issues)
- 討論區: [GitHub Discussions](https://github.com/fallrising/bee_swarm/discussions)

#### 報告 Bug
請提供以下信息：
1. 錯誤信息完整輸出
2. 操作系統和版本
3. Docker 版本
4. 重現步驟
5. 期望行為 vs 實際行為

#### 功能請求
請在 GitHub Issues 中使用 "feature-request" 標籤，並描述：
1. 功能需求描述
2. 使用場景
3. 預期收益
4. 可能的實現方案

---

## 性能優化建議

### 系統優化
```bash
# 調整系統參數
echo 'vm.swappiness=10' >> /etc/sysctl.conf
echo 'net.core.somaxconn=65535' >> /etc/sysctl.conf
sysctl -p
```

### 應用優化
```yaml
# 優化 Docker 配置
version: '3.8'
services:
  app:
    image: bee-swarm:latest
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
      restart_policy:
        condition: unless-stopped
```

### 監控設置
```bash
# 設置基礎監控
docker run -d \
  --name=netdata \
  -p 19999:19999 \
  -v /proc:/host/proc:ro \
  -v /sys:/host/sys:ro \
  netdata/netdata
``` 