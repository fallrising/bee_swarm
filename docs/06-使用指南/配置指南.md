# 配置指南 (Configuration Guide)

## 🔧 概述

本指南提供 Bee Swarm 系統的完整配置說明，涵蓋環境變量、AI 角色配置、GitHub 集成、監控設置和安全配置等方面。

## 📋 環境變量配置

### 基礎配置
```bash
# 系統基礎配置
ENVIRONMENT=development  # development, staging, production
LOG_LEVEL=info          # debug, info, warning, error
DEBUG=false             # 是否啟用調試模式
TIMEZONE=Asia/Shanghai  # 系統時區

# 應用配置
APP_NAME=bee-swarm
APP_VERSION=1.0.0
API_PREFIX=/api/v1
```

### GitHub 集成配置
```bash
# GitHub 基本配置
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxx  # GitHub Personal Access Token
GITHUB_OWNER=your-organization         # GitHub 組織或用戶名
GITHUB_REPO=your-repository           # 默認倉庫名

# GitHub API 配置
GITHUB_API_URL=https://api.github.com
GITHUB_WEBHOOK_SECRET=your-webhook-secret
GITHUB_APP_ID=123456                  # 如果使用 GitHub App

# GitHub Actions 配置
ENABLE_GITHUB_ACTIONS=true
ACTIONS_WORKFLOW_PATH=.github/workflows
```

### AI 工具配置
```bash
# OpenAI 配置
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxx
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=4000
OPENAI_TEMPERATURE=0.7

# Claude 配置
CLAUDE_API_KEY=sk-ant-xxxxxxxxxxxxx
CLAUDE_MODEL=claude-3-sonnet-20240229
CLAUDE_MAX_TOKENS=4000

# 其他 AI 服務
GEMINI_API_KEY=your-gemini-key
COHERE_API_KEY=your-cohere-key
```

## 🤖 AI 角色配置

### 產品經理配置
```yaml
# roles/product_manager/config.yml
role_config:
  name: "Product Manager"
  description: "負責產品策略和需求管理"
  
  ai_settings:
    model: "gpt-4"
    temperature: 0.3
    max_tokens: 2000
    system_prompt: |
      你是一個經驗豐富的產品經理，專注於...
  
  capabilities:
    - requirement_analysis
    - priority_management
    - stakeholder_communication
    - roadmap_planning
  
  tools:
    - github_issues
    - project_boards
    - analytics_dashboard
  
  workflow:
    response_time: 30  # 分鐘
    review_frequency: daily
    escalation_threshold: high
```

### 後端開發者配置
```yaml
# roles/backend_developer/config.yml
role_config:
  name: "Backend Developer"
  description: "負責服務端開發和架構設計"
  
  ai_settings:
    model: "claude-3-sonnet"
    temperature: 0.2
    max_tokens: 3000
  
  technical_stack:
    languages: [python, java, go]
    frameworks: [fastapi, spring, gin]
    databases: [postgresql, redis, mongodb]
    tools: [docker, kubernetes, prometheus]
  
  code_standards:
    style_guide: "pep8"
    test_coverage: 80
    documentation: required
```

## 📊 監控配置

### Prometheus 配置
```yaml
# config/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

scrape_configs:
  - job_name: 'bee-swarm-backend'
    static_configs:
      - targets: ['backend:8000']
    metrics_path: /metrics
    scrape_interval: 10s

  - job_name: 'bee-swarm-simulator'
    static_configs:
      - targets: ['simulator:8001']

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

### 告警規則配置
```yaml
# config/alert_rules.yml
groups:
  - name: bee-swarm-alerts
    rules:
      - alert: HighResponseTime
        expr: http_request_duration_seconds > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "高響應時間警告"
          description: "響應時間超過 1 秒"

      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "高錯誤率警告"
```

## 🔒 安全配置

### 身份驗證配置
```bash
# JWT 配置
JWT_SECRET_KEY=your-super-secret-jwt-key
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# API 密鑰配置
API_KEY_HEADER=X-API-Key
RATE_LIMIT_REQUESTS=1000
RATE_LIMIT_WINDOW=3600
```

### 數據庫安全配置
```bash
# PostgreSQL 配置
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=bee_swarm
POSTGRES_USER=bee_user
POSTGRES_PASSWORD=secure_password_here

# Redis 配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=redis_password_here
REDIS_DB=0
```

## 🐳 Docker 配置

### Docker Compose 配置
```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build: 
      context: .
      dockerfile: Dockerfile.backend
    environment:
      - ENVIRONMENT=${ENVIRONMENT}
      - DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis
    ports:
      - "8000:8000"
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:
```

## ⚙️ 高級配置

### 緩存配置
```python
# config/cache.py
CACHE_CONFIG = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://redis:6379/1',
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        },
        'KEY_PREFIX': 'bee_swarm',
        'TIMEOUT': 300,
    },
    'session': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://redis:6379/2',
        'TIMEOUT': 3600,
    }
}
```

### 異步任務配置
```python
# config/celery.py
CELERY_CONFIG = {
    'broker_url': 'redis://redis:6379/3',
    'result_backend': 'redis://redis:6379/4',
    'task_serializer': 'json',
    'accept_content': ['json'],
    'result_serializer': 'json',
    'timezone': 'Asia/Shanghai',
    'enable_utc': True,
    'task_routes': {
        'roles.tasks.*': {'queue': 'roles'},
        'simulation.tasks.*': {'queue': 'simulation'},
        'github.tasks.*': {'queue': 'github'},
    }
}
```

## 🔧 配置管理最佳實踐

### 環境分離
```bash
# 開發環境 (.env.development)
DEBUG=true
LOG_LEVEL=debug
GITHUB_REPO=bee-swarm-dev

# 測試環境 (.env.testing)
DEBUG=false
LOG_LEVEL=info
GITHUB_REPO=bee-swarm-test

# 生產環境 (.env.production)
DEBUG=false
LOG_LEVEL=warning
GITHUB_REPO=bee-swarm-prod
```

### 配置驗證
```python
# config/validation.py
import os
from typing import Optional

class ConfigValidator:
    REQUIRED_VARS = [
        'GITHUB_TOKEN',
        'POSTGRES_PASSWORD',
        'JWT_SECRET_KEY'
    ]
    
    @classmethod
    def validate(cls) -> None:
        missing_vars = []
        for var in cls.REQUIRED_VARS:
            if not os.getenv(var):
                missing_vars.append(var)
        
        if missing_vars:
            raise ValueError(f"Missing required environment variables: {missing_vars}")
    
    @classmethod
    def get_github_config(cls) -> dict:
        return {
            'token': os.getenv('GITHUB_TOKEN'),
            'owner': os.getenv('GITHUB_OWNER'),
            'repo': os.getenv('GITHUB_REPO'),
            'api_url': os.getenv('GITHUB_API_URL', 'https://api.github.com')
        }
```

---

> **注意**: 請確保敏感配置（如 API 密鑰、密碼）不要提交到版本控制系統中。使用 `.env` 文件或安全的密鑰管理服務。 